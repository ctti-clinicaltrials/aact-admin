<div class="snapshots-wrapper">
  <div class="details-controls">
    <%= link_to "Back", downloads_path, class: "btn btn-secondary control-btn" %>
    <div class="snapshots-title"><%= snapshot_title(@type) %></div>
  </div>
  <% if @all_snapshots.present? %>
    <!-- Daily Snapshots Section -->
    <div class="snapshots-section">
      <h2 class="snapshots-section-title">Recent Daily Snapshots</h2>
      <div class="snapshots-grid-table">
        <!-- Grid Header -->
        <div class="snapshots-grid-row snapshots-grid-header">
          <div>Date</div>
          <div>File Name</div>
          <div>Size</div>
          <div>Actions</div>
        </div>
        <!-- Grid Rows -->
        <% if @paginated_daily_snapshots.present? && @paginated_daily_snapshots.any? %>
          <% @paginated_daily_snapshots.each do |snapshot| %>
            <div class="snapshots-grid-row">
              <div data-label="Date:"><strong><%= snapshot["date"] %></strong></div>
              <div data-label="File:"><%= snapshot["file_name"] %></div>
              <div data-label="Size:"><%= snapshot["size"] %></div>
              <div class="snapshots-grid-actions">
                <a href="<%= snapshot["download_url"] %>"
                  class="snapshots-action-button primary">
                  Download
                </a>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="snapshots-grid-row empty-row">
            <div colspan="4">No daily snapshots available.</div>
          </div>
        <% end %>
      </div>
      <!-- Pagination for Daily Snapshots -->
      <div class="pagination-wrapper mt-3">
        <%= paginate @paginated_daily_snapshots,
          class: "pagination",
          inner_window: 2,
          outer_window: 0
          %>
      </div>
    </div>
    <!-- Monthly Snapshots Section -->
    <div class="snapshots-section mt-5">
      <h2 class="snapshots-section-title">Monthly Archives</h2>
      <!-- Year Navigation -->
      <div class="year-navigation">
        <% if @all_snapshots[:monthly].present? && @all_snapshots[:monthly].any? %>
          <% @all_snapshots[:monthly].keys.sort.reverse.each do |year| %>
            <%= link_to year,
                snapshots_downloads_path(type: @type, year: year),
                class: "year-link #{year == @year ? 'selected-year' : ''}" %>
          <% end %>
        <% end %>
      </div>
      <div class="snapshots-grid-table">
        <div class="snapshots-grid-row snapshots-grid-header">
          <div>Date</div>
          <div>File Name</div>
          <div>Size</div>
          <div>Actions</div>
        </div>
        <!-- Grid Rows -->
        <% if @all_snapshots[:monthly][@year].present? && @all_snapshots[:monthly][@year].any? %>
          <% @all_snapshots[:monthly][@year].sort_by { |s| s["date"] }.reverse.each do |snapshot| %>
            <div class="snapshots-grid-row">
              <div data-label="Date:"><%= snapshot["date"] %></div>
              <div data-label="File:"><%= snapshot["file_name"] %></div>
              <div data-label="Size:"><%= snapshot["size"] %></div>
              <div class="snapshots-grid-actions">
                <%= link_to snapshot["download_url"], class: "snapshots-action-button primary", download: snapshot["file_name"] do %>
                  Download
                <% end %>
              </div>
            </div>
          <% end %>
        <% else %>
          <div class="snapshots-grid-row empty-row">
            <div colspan="4">No monthly snapshots available for <%= @year %>.</div>
          </div>
        <% end %>
      </div>
    </div>
  <% else %>
    <div class="empty-state">
      No snapshot data is currently available.
    </div>
  <% end %>
  <% if Rails.env.development? %>
    <div class="debug-info mt-4">
      <strong>Debug:</strong> Snapshot type: <%= @type %>
      <pre><%= JSON.pretty_generate(@all_snapshots) rescue @all_snapshots.inspect %></pre>
    </div>
  <% end %>
</div>